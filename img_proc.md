# 图像处理和opencv
　&nbsp;　　　　  　　　　　　　 sqlu@zju.edu.cn
##引言
本笔记记录了关于图像的基本概念,方法和实现它们的技术手段:opencv的使用.
 本文分成以下几个部分:

- 颜色空间(GRAY,RGB,HSV,YUV[NV12,NV21])
- 图像变换与操作(灰度变换,形态学,卷积,opencv基本数据结构)
- 图像压缩与输入输出(了解一下图像存储格式,opencv/PIL的IO操作,绘制)
- 背景提取
- 图像特征点和描述
- 直方图与跟踪
- 光流
###稀疏光流

###稠密光溜

###采用深度学习计算光流
    Fischer P., Dosovitskiyz A. , Ilgz E., et al, FlowNet: Learning Optical Flow with Convolutional Networks. ICCV 2015
    Ilg  E., Mayer N., Saikia T., et.al. FlowNet 2.0: Evolution of Optical Flow Estimation with Deep Networks, CVPR 2017

- 三维视觉





RGB: 适用于硬件
HSV:
YUV家族(包括YCbCr)
Y = 0.299R+0.587G+0.114B
Cb = 0.564(B-Y)  里面含0.5B  (范围在[-127,127])
Cr = 0.713(R-Y)  里面含0.5R  (范围在-127~+127)
UV分别是Cb+128与Cr+128
YUV4:4:4 YUV4:2:2 YUV4:1:1，YUV4:2:0是指码流中存储的形式,除了第一种以外,uv都是空间降采样的
根据存放形式不同，还有plane(YUV分别存放)和pack(交替存放)形式

混合高斯模型背景建模(参数化模型)
认为每个像素点在过去一段时间内符合混合高斯分布
1.初始化。对第一帧，以随机像素值为均值,给定方差,建立K个高斯模型，权重均为1/k  K一般取3~5
2.更新。匹配高斯分布(以小于D个标准差为判据,D一般取2.50-3.5)，
若匹配，则
    w = (1-a)*w+a
    mean = (1-p)*mean+p*X
    std2 = (1-p)*std2+p*(X-mean)**2
    a为学习率 p = a* gaussian(X)
若不匹配，则
w = (1-a)*w
若所有模式都不匹配，则
创建新的高斯分布，以该像素值为均值，给定方差，替换掉权重最小的高斯分布
最后对所有权重进行归一化
3.预测。按照w/std从大到小排序，并且给定背景所占比例T(T>0.7), 当对权重求cumsum时达到T时，匹配分布在T以内高斯时，为背景，否则为前景
ViBe(Visual Background Extractor)
认为每个背景像素值在一个样本集在领域内
1.初始化  对于一个像素点，随机的选择它的邻居点的像素值作为它的模型样本值
2.更新 保守的更新策略+前景点计数方法。保守的更新策略前景点永远不会被用来填充背景模型。前景点计数：对像素点进行统计，如果某个像素点连续N次被检测为前景，则将其更新为背景点。
连续多次选取前景的像素更新为背景，每一个背景点有φ的概率去更新自己的模型样本值，同时也有φ的概率去更新它的邻居点的模型样本值。
在选择要替换的样本集中的样本值时候，随机选取一个样本值进行更新
3.预测。
比较样本集合中各点与预测点L2,统计符合条件的点数，小于阈值时为前景，否则为背景
